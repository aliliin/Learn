## 			高并发解决方案总结

#### 流量优化

做些防盗链处理 Referer

通过Referer或者签名的方式可以坚持目标网页的访问的访问来源网页

如果是资源文件,则可以跟踪到显示它的网页地址,一旦检查到来源不是本站就进行阻止,或者返回相应的指定页面

Nginx模块: ngx_http_referer_module  用于阻挡来源的非法的域名请求

Nginx指令: valid_referers  全局变量的使用 $invalid_referer

####  前端优化

减少HTTP的后台请求,js文件css文件压缩合并,图片合并.添加异步请求

启用浏览器的缓存和文件压缩,缓存HTML文件在浏览器

CDN加速 ,资源静态化

建立独立的图片服务器,大文件的服务器

####  服务端优化

页面实现静态化,PHP文件缓存成静态的HTML文件

并发处理,队列处理

####  数据库优化

MySQL缓存,文件缓存,服务器内存缓存 启用MySQL查询缓存 query_cache_type

0 不使用 ,1  始终使用, 2 表示按需要使用

数据库的缓存使用 Memcache,分布式的高速缓存系统  端口：11211， value 最大是 1M, 有效期是 30 天

通过内存中维护一个统一的巨大的hash表,他能够用来存储各种格式的数据,包括,图片,视频,文件以及数据检索出来的结果等,

简单的说,就是将数据调用到内存,然后从内存中读取,从而大大提高读取速度.

工作流程:先检查客户端的请求数据是否在memcache中,如果有直接获取,不再对数据库进行任何操作,如果请求的数据不存在memcache中,就去查数据库,把从数据库中获取的数据,返回给客户端,同时吧数据缓存一份到memcache中

get获取数据 set 设置(key,val,expire) delete(key)删除

Redis,缓存的使用  value 最大 512M ，有序用 list 和 sorted  set ,无序用 set, 发起事务用 multi; 持久化方式为内存快照和日志追加。redis事务支持比较弱,只能保证事务中的每个操作连续执行, redis支持多种类型的数据.

字符串   列表  集合 有序集合,哈希

MySQL优化:数据表结构设计,数据类型的优化.索引优化,SQL语句的优化,使用limit,

手机号存 char, 年龄存,tinyint类型,md5加密也存char,可变的数据存varchar,IP地址存整型,可以用PHP函数,转换成长整型.

查询数据比较大,用limit做限制,一次查询一些,分解关联查询,优化关联查询

MySQL分库分表,分区进行操作,可以水平拆分,垂直拆分,

读写分离,主从复制

负载均衡的实现 Nginx的proxy实现了7层负载均衡,内置的策略: IPHash ,加权轮询

配置:

http{

​	upstream 你自己的集群名称 {

​		server 1,(ip)

​		server 2,

​		….. 

​	}

​	server{

​		location / {

​			proxy_pass 你自己的集群名称

​			}

​	}

}

SQL语句安全方案:

使用预处理做防范SQL注入,,写入数据的时候要做特殊字符的转义.查询错误的结果不要返回给用户.将错误记录到日志.尽量使用PDO操作数据库,定期数据备份,服务器数据库合理分配权限,关闭远程访问数据库的权限

